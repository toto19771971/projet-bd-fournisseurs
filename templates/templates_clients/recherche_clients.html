<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Recherche clients</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_clients.css') }}">
    <style>
      h1 {
        text-align: center;
      }
      /* Votre style interne, identique √† ce que vous aviez (mise en page, dimensions, centrage, etc.) */
      .buttons {
        display: flex;
        flex-wrap: nowrap;
        gap: 10px;
        margin-bottom: 15px;
      }
      .buttons button {
        background-color: #007BFF; /* Cette couleur sera surcharg√©e */
        color: white;              
        border: none;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 16px;
        border-radius: 5px;
      }
      .buttons button:hover {
        background-color: #0056b3;
      }
      .suggestions {
        border: 1px solid #ccc;
        background: white;
        max-height: 150px;
        overflow-y: auto;
        position: absolute;
        width: 250px;
        z-index: 10;
      }
      .suggestions div {
        padding: 5px;
        cursor: pointer;
      }
      .suggestions div:hover {
        background-color: #e9e9e9;
      }
      .mandatory::after {
        content: " *";
        color: red;
      }
      .form-group {
        margin-bottom: 10px;
      }
      label {
        display: block;
        margin-bottom: 5px;
      }
      input, select, textarea {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
      }
      .container {
        max-width: 600px;
        margin: 0 auto;
      }
      
    </style>
    <!-- [RED] Utiliser style_clients.css -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style_clients.css') }}">
  </head>
<body>
  <div class="container">
    <!-- [RED] Changer le titre -->
    <h1>Gestion des Clients</h1>

    <!-- Barre de 7 boutons -->
    <div class="buttons">
      <button type="button" onclick="imprimer()">Imprimer</button>
      <button type="button" onclick="ouvrirWikipedia()">Wikip√©dia</button>
      <button type="button" onclick="creer()">Cr√©er</button>
      <button type="button" onclick="afficherRecherche()">Chercher</button>
      <!-- [RED] Renommer la fonction modifier en modifierClient -->
      <button type="button" onclick="modifierClient()">Modifier</button>
      <button type="button" onclick="supprimer()">Supprimer</button>
      <button type="button" onclick="retour()">Retour</button>
    </div>

    <!-- Zone de recherche -->
    <div id="zone-recherche" style="display: none; position: relative;">
      <label for="search-input">üîç Rechercher :</label>
      <input type="text" id="search-input" placeholder="Tapez un nom ou un code...">
      <div id="suggestions" class="suggestions"></div>
    </div>

    <!-- Formulaire avec 19 champs -->
    <form id="formulaire">
      <div class="form-group">
        <!-- [RED] Remplacer "Code fournisseur" par "Code client" -->
        <label class="mandatory" for="code_client">Code client</label>
        <input type="text" id="code_client" name="Code client" required>
      </div>
      <div class="form-group">
        <!-- [RED] Remplacer "Nom du fournisseur" par "Nom du client" -->
        <label class="mandatory" for="nom_client">Nom du client</label>
        <input type="text" id="nom_client" name="Nom du client" required>
      </div>
      <div class="form-group">
        <label for="personne_responsable">Personne responsable</label>
        <input type="text" id="personne_responsable" name="Personne responsable">
      </div>
      <div class="form-group">
        <label for="adresse">Adresse</label>
        <input type="text" id="adresse" name="Adresse">
      </div>
      <div class="form-group">
        <label for="npa_ville">NPA/Ville</label>
        <input type="text" id="npa_ville" name="NPA/Ville">
      </div>
      <div class="form-group">
        <label class="mandatory" for="no_telephone_1">No t√©l√©phone 1</label>
        <input type="text" id="no_telephone_1" name="No t√©l√©phone 1" required>
      </div>
      <div class="form-group">
        <label for="no_telephone_2">No t√©l√©phone 2</label>
        <input type="text" id="no_telephone_2" name="No t√©l√©phone 2">
      </div>
      <div class="form-group">
        <label for="site_internet">Site internet</label>
        <input type="text" id="site_internet" name="Site internet">
      </div>
      <div class="form-group">
        <label for="email">E-mail</label>
        <input type="email" id="email" name="E-mail">
      </div>
      <div class="form-group">
        <label class="mandatory" for="compte_a_crediter">Compte √† cr√©diter</label>
        <select id="compte_a_crediter" name="Compte √† cr√©diter" required>
          <option value="">S√©lectionner un compte</option>
          {% for row in crediter_options %}
            <option value="{{ row['Num√©ro de compte'] }} - {{ row['Libell√©'] }} - {{ row['Cat√©gorie'] }}">
              {{ row['Num√©ro de compte'] }} - {{ row['Libell√©'] }} - {{ row['Cat√©gorie'] }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label class="mandatory" for="compte_a_debiter">Compte √† d√©biter</label>
        <select id="compte_a_debiter" name="Compte √† d√©biter" required>
          <option value="">S√©lectionner un compte</option>
          {% for row in debiter_options %}
            <option value="{{ row['Num√©ro de compte'] }} - {{ row['Libell√©'] }} - {{ row['Cat√©gorie'] }}">
              {{ row['Num√©ro de compte'] }} - {{ row['Libell√©'] }} - {{ row['Cat√©gorie'] }}
            </option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label class="mandatory" for="taux_tva1">Taux TVA 1</label>
        <select id="taux_tva1" name="Taux TVA 1" required>
          <option value="">S√©lectionner un taux</option>
          {% for tva in tva_options %}
            <option value="{{ tva['Taux TVA'] }}">{{ tva['Taux TVA'] }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="taux_tva2">Taux TVA 2</label>
        <select id="taux_tva2" name="Taux TVA 2">
          <option value="">S√©lectionner un taux</option>
          {% for tva in tva_options %}
            <option value="{{ tva['Taux TVA'] }}">{{ tva['Taux TVA'] }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label class="mandatory" for="delai_de_paiement">D√©lai de paiement</label>
        <select id="delai_de_paiement" name="D√©lai de paiement" required>
          <option value="">S√©lectionner un d√©lai</option>
          {% for delai in delai_options %}
            <option value="{{ delai['D√©lai de paiement'] }}">{{ delai['D√©lai de paiement'] }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group">
        <label for="nom_de_la_banque">Nom de la banque</label>
        <input type="text" id="nom_de_la_banque" name="Nom de la banque">
      </div>
      <div class="form-group">
        <label for="npa_ville_banque">NPA/Ville banque</label>
        <input type="text" id="npa_ville_banque" name="NPA/Ville banque">
      </div>
      <div class="form-group">
        <label for="no_de_compte">No de compte</label>
        <input type="text" id="no_de_compte" name="No de compte">
      </div>
      <div class="form-group">
        <label for="iban">IBAN</label>
        <input type="text" id="iban" name="IBAN">
      </div>
      <div class="form-group">
        <label for="commentaire">Commentaire</label>
        <textarea id="commentaire" name="Commentaire"></textarea>
      </div>
    </form>

    <!-- Bouton "Vider le formulaire" -->
    <div class="form-group" style="text-align: center; margin-top: 20px;">
      <button type="button" onclick="viderFormulaire()" style="background-color: #ff4d4d; color: white; padding: 10px 20px; border: none; border-radius: 5px; font-size: 16px;">Vider le formulaire</button>
    </div>

    <script>
      function afficherRecherche() {
        var zone = document.getElementById("zone-recherche");
        zone.style.display = (zone.style.display === "block") ? "none" : "block";
      }

      document.getElementById("search-input").addEventListener("input", function() {
        let query = this.value;
        fetch(`/autocomplete?query=${query}`)
          .then(response => response.json())
          .then(data => {
            document.getElementById("suggestions").innerHTML = data.map(f =>
              `<div onclick='remplirFormulaire(${JSON.stringify(f)})'>` +
                // [RED] Remplacer "fournisseur" par "client" dans l'affichage
                f["Code client"] + " - " + f["Nom du client"] +
              `</div>`
            ).join("");
          });
      });

      function remplirFormulaire(f) {
        const mapping = {
          // [RED] Remplacer les cl√©s avec "fournisseur" par "client"
          "Code client": "code_client",
          "Nom du client": "nom_client",
          "Personne responsable": "personne_responsable",
          "Adresse": "adresse",
          "NPA/Ville": "npa_ville",
          "No t√©l√©phone 1": "no_telephone_1",
          "No t√©l√©phone 2": "no_telephone_2",
          "Site internet": "site_internet",
          "E-mail": "email",
          "Compte √† cr√©diter": "compte_a_crediter",
          "Compte √† d√©biter": "compte_a_debiter",
          "Taux TVA 1": "taux_tva1",
          "Taux TVA 2": "taux_tva2",
          "D√©lai de paiement": "delai_de_paiement",
          "Nom de la banque": "nom_de_la_banque",
          "NPA/Ville banque": "npa_ville_banque",
          "No de compte": "no_de_compte",
          "IBAN": "iban",
          "Commentaire": "commentaire"
        };
        for (const [col, id] of Object.entries(mapping)) {
          const field = document.getElementById(id);
          if (field) {
            field.value = f[col] || "";
          }
        }
      }

      function modifierClient() {
        const requiredFields = [
          {id: "code_client", name: "Code client"},
          {id: "nom_client", name: "Nom du client"},
          {id: "no_telephone_1", name: "No t√©l√©phone 1"},
          {id: "compte_a_crediter", name: "Compte √† cr√©diter"},
          {id: "compte_a_debiter", name: "Compte √† d√©biter"},
          {id: "taux_tva1", name: "Taux TVA 1"},
          {id: "delai_de_paiement", name: "D√©lai de paiement"}
        ];
        for (let field of requiredFields) {
          let elem = document.getElementById(field.id);
          if (!elem.value.trim()) {
            alert("Champ obligatoire manquant: " + field.name);
            return;
          }
        }
        let formData = new FormData(document.getElementById("formulaire"));
        console.log("Modification du client, donn√©es :", Object.fromEntries(formData.entries()));
        fetch("/modifier", {
          method: "POST",
          body: formData
        })
        .then(response => response.json())
        .then(data => { alert(data.message); })
        .catch(error => {
          alert("Erreur lors de la modification !");
          console.error(error);
        });
      }

      function creer() {
        const requiredFields = [
          {id: "code_client", name: "Code client"},
          {id: "nom_client", name: "Nom du client"},
          {id: "no_telephone_1", name: "No t√©l√©phone 1"},
          {id: "compte_a_crediter", name: "Compte √† cr√©diter"},
          {id: "compte_a_debiter", name: "Compte √† d√©biter"},
          {id: "taux_tva1", name: "Taux TVA 1"},
          {id: "delai_de_paiement", name: "D√©lai de paiement"}
        ];
        for (let field of requiredFields) {
          let elem = document.getElementById(field.id);
          if (!elem.value.trim()) {
            alert("Champ obligatoire manquant: " + field.name);
            return;
          }
        }
        let formData = new FormData(document.getElementById("formulaire"));
        console.log("Cr√©ation du client, donn√©es :", Object.fromEntries(formData.entries()));
        fetch("/creer", {
          method: "POST",
          body: formData
        })
        .then(response => response.json())
        .then(data => { alert(data.message); })
        .catch(error => {
          alert("Erreur lors de la cr√©ation du client !");
          console.error(error);
        });
      }

      function supprimer() {
        let code = document.getElementById("code_client").value.trim();
        if (!code) {
          alert("Champ obligatoire manquant: Code client (pour supprimer)");
          return;
        }
        let formData = new FormData(document.getElementById("formulaire"));
        console.log("Suppression du client, code :", code);
        fetch("/supprimer", {
          method: "POST",
          body: formData
        })
        .then(response => response.json())
        .then(data => { alert(data.message); })
        .catch(error => {
          alert("Erreur lors de la suppression du client !");
          console.error(error);
        });
      }
  
      function retour() {
        window.location.href = "{{ url_for('comptabilite_clients') }}";
      }
    
      function imprimer() {
        window.print();
      }

      function ouvrirWikipedia() {
        window.open("https://fr.wikipedia.org", "_blank");
      }

      function viderFormulaire() {
        document.getElementById("formulaire").reset();
      }
    </script>
  </div>
</body>
</html>
